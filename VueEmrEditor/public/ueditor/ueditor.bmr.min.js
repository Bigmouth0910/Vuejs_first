"use strict";function ChangeWidget(){this.changes=[],this.allwidgets=[],this.editor=window.top.UE.getEditor("ueditor"),this.init=function(){var e=this;e.editor.ready(function(){var t=this.execCommand("allwidgets");e.allwidgets=t,window.top.allwidgets=t})},this.showChange=function(){var e=this;window.top.changes=e.changes,e.editor.focus()}}function ceshi(){console.log(ceshi)}Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e},window.onload=function(){var e=new ChangeWidget;e.init(),e.change()},ChangeWidget.prototype={change:function(){for(var e=window.top.allwidgets||this.allwidgets,t=0;t<e.length;t++){var n=e[t],a=n.type,i=n.target,s=n.value;switch(a){case"input":this.inputChange(i,s,t);break;case"select":this.selectChange(i,s,t);break;case"timeinput":this.timeinputChange(i,s,t);break;case"checkbox":this.checkboxChange(i,s,t);break;case"radio":this.radioChange(i,s,t)}}},inputChange:function(e,t,n){function a(e,t){var a=(new Date).format("yyyy-MM-dd HH:mm:ss");t!=e&&""!=t?i.changes[n]={date:a,author:"peng.hongbao",type:"修改了内容",desc:e+"修改成"+t}:t!=e&&""==t?i.changes[n]={date:a,author:"peng.hongbao",type:"删除了内容",desc:"删除"+e}:delete i.changes[n],i.showChange()}var i=this,s=t,h=null;e.addEventListener("keyup",function(e){var t=e.target.innerHTML;clearTimeout(h),h=setTimeout(function(){a(s,t)},400)})},selectChange:function(e,t,n){var a=this,i=t;e.addEventListener("click",function(e){if((e.target.className||"").indexOf("li")>-1){if(newValue=e.target.innerText,i!=newValue){var t=(new Date).format("yyyy-MM-dd HH:mm:ss");a.changes[n]={date:t,author:"peng.hongbao",type:"修改了内容",desc:i+"修改成"+newValue}}else delete a.changes[n];a.showChange()}})},timeinputChange:function(e,t,n){var a=this,i=t,s=e.getElementsByTagName("input")[1];$dp.focusArr[0].addEventListener("click",function(e){var t=s.value;if(t!=i){var h=(new Date).format("yyyy-MM-dd HH:mm:ss");a.changes[n]={date:h,author:"peng.hongbao",type:"修改了时间",desc:i+"修改成"+t}}else delete a.changes[n];a.showChange()})},checkboxChange:function(e,t,n){var a=this,i=t;e.addEventListener("click",function(t){if("INPUT"==t.target.tagName){for(var s=[],h=e.getElementsByTagName("input"),o=0;o<h.length;o++)h[o].checked&&s.push(h[o].value);if(s!=i){var g=(new Date).format("yyyy-MM-dd HH:mm:ss");a.changes[n]={date:g,author:"peng.hongbao",type:"修改",desc:i+"修改成"+s}}else delete a.changes[n];a.showChange()}})},radioChange:function(e,t,n){var a=this,i=t;e.addEventListener("click",function(t){if("INPUT"==t.target.tagName){for(var s=[],h=e.getElementsByTagName("input"),o=0;o<h.length;o++)h[o].checked&&s.push(h[o].value);if(s!=i){var g=(new Date).format("yyyy-MM-dd HH:mm:ss");a.changes[n]={date:g,author:"peng.hongbao",type:"修改",desc:i+"修改成"+s}}else delete a.changes[n];a.showChange()}})}};